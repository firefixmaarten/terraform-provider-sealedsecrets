name: ci

on:
  push:
    branches:
      - '**'

jobs:
  ci:
    name: ci
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1

    - name: Set output
      id: vars
      run: echo ::set-output name=tag::${GITHUB_REF#refs/*/}

    - uses: actions/setup-go@v1
      with:
        go-version: '1.12'

    - name: set GOPATH
      run: |
        echo "##[set-env name=GOPATH;]$(dirname $GITHUB_WORKSPACE)"
        echo "##[add-path]$(dirname $GITHUB_WORKSPACE)/bin"
      shell: bash

    - name: test and build
      env:
        VERSION: ${{ steps.vars.outputs.tag }}
      run: |
        make
        